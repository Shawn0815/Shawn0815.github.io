---
title: å–®å…ƒ 16 - æ””æˆªå™¨ Interceptor
author: shawn_yu
date: 2025-08-07 02:55:00 +0800
categories: [Spring boot, Spring MVC]
tags: [Spring boot, Spring MVC]
image: /assets/img/2025-08-07-03-53-50.png
math: true
---

## Interceptor

ç•¶å‰ç«¯ç™¼èµ·ä¸€å€‹ http requestï¼Œinterceptor æœƒå…ˆå°‡å®ƒæ””ä¸‹ä¾†ï¼Œä¸¦ **<mark><font color="red">æª¢æŸ¥æ­¤ http request æœ‰ç„¡å•é¡Œ</font></mark>**ã€‚  
<br>

1. æ²’å•é¡Œï¼šå…è¨± http request é€²åˆ° Controller è£¡é¢ï¼ŒåŸ·è¡Œ url è·¯å¾‘å°æ‡‰çš„ test() æ–¹æ³•ã€‚
    ![](/assets/img/2025-08-07-03-08-24.png)

2. æœ‰å•é¡Œï¼šä¸å…è¨± http request åŸ·è¡Œå°æ‡‰æ–¹æ³•ï¼Œè€Œæ˜¯ **<mark><font color="red">ç›´æ¥è¿”å›éŒ¯èª¤è¨Šæ¯</font></mark>**çµ¦å‰ç«¯ã€‚
    ![](/assets/img/2025-08-07-03-08-58.png)
    

â‡’ Interceptorï¼ˆæ””æˆªå™¨ï¼‰æœ‰é»é¡ä¼¼ä¿å…¨çš„æ¦‚å¿µï¼Œæª¢æŸ¥ http request æ˜¯å¦æœ‰å•é¡Œã€‚

---

## å¯¦ä½œ Interceptor

### Code å¯«æ³•

1. å…ˆæŠŠ MyController ä¸­ test1() èˆ‡ test2() æ–¹æ³•åšæ”¹å¯«ã€‚
    ![](/assets/img/2025-08-07-03-09-47.png)
    
2. å»ºç«‹ä¸€å€‹æ””æˆªå™¨ï¼šæ–°å¢æ–°çš„ class MyInterceptorï¼Œåœ¨ä¸Šé¢åŠ ä¸Š **<mark><font color="red">@Component è¨»è§£</font></mark>**ï¼Œä¸¦å» **<mark><font color="red">å¯¦ç¾ HandlerInterceptor interface</font></mark>**ã€‚
    ![](/assets/img/2025-08-07-03-10-08.png)
    
3. è¦åœ¨ MyInterceptor class ä¸­å¯«æ””æˆª http request çš„åˆ¤æ–·é‚è¼¯ï¼Œæˆ‘å€‘å…ˆæŸ¥çœ‹ HandlerInterceptor interface çš„å…§å®¹ã€‚
    1. **<mark><font color="red">preHandle() æ–¹æ³•</font></mark>**ï¼šhttp request ä¸€é€²ä¾†æ™‚ï¼Œæ””æˆªå™¨å°±æœƒåŸ·è¡Œæ­¤æ–¹æ³•ï¼Œå»åˆ¤æ–· http request æ˜¯å¦æœ‰å•é¡Œã€‚
    2. postHandle(), afterCompletion() æ–¹æ³•ï¼šåœ¨ url è·¯å¾‘å°æ‡‰çš„æ–¹æ³•åŸ·è¡Œå®Œç•¢å¾Œï¼Œæ””æˆªå™¨æ‰æœƒå»åŸ·è¡Œé€™å…©å€‹æ–¹æ³•ã€‚
        ![](/assets/img/2025-08-07-03-10-17.png)  
        <br>

4. åœ¨ MyController ä¸­å¯¦ä½œ HandlerInterceptor çš„ preHandle() æ–¹æ³•ï¼š
    1. å·¦éµ â†’ Generate â†’ Override method â†’ é¸æ“‡ preHandle() æ–¹æ³•ã€‚
        ![](/assets/img/2025-08-07-03-10-26.png)
        
    2. preHandle() æ–¹æ³•æœƒè¿”å›ä¸€å€‹ boolean å€¼ï¼Œtrue ä»£è¡¨å…è¨±æ­¤ http request é€šéï¼Œfalse ä»£è¡¨ä¸å…è¨±æ­¤ http request é€šéï¼Œå› æ­¤ **<mark><font color="red">å¦‚ä½•è¨­è¨ˆé€™å€‹æ–¹æ³•çš„è¿”å›å€¼éå¸¸é‡è¦</font></mark>**ã€‚
        ![](/assets/img/2025-08-07-03-10-34.png)
        
    3. ä¾‹å¦‚ï¼šæˆ‘å€‘å¯ä»¥é™åˆ¶ http request çš„ header å…§å®¹ï¼Œä¾†æ±ºå®šæ˜¯å¦å…è¨± http request é€šéç­‰ç­‰ã€‚
    
5. å»ºç«‹ä¸€å€‹æ–°çš„ class MyConfigï¼Œä¸¦åœ¨ä¸Šé¢åŠ ä¸Š @Configuration è¨»è§£ï¼Œä¹Ÿå°±æ˜¯å°‡é€™å€‹ class æˆç‚ºä¸€å€‹è¨­å®š Spring çš„ class  â‡’  æˆ‘å€‘å¯ä»¥åœ¨é€™å€‹ class ä¸­ **<mark><font color="red">è¨­å®šè¦å°‡æ””æˆªå™¨å¥—ç”¨åˆ°å“ªäº› url è·¯å¾‘ä¸Š</font></mark>**ã€‚
    1. å°‡ MyConfig class å»å¯¦ç¾ WebMvcConfigurer interfaceã€‚
    2. Override addInterceptors() æ–¹æ³•ã€‚
    3. åŠ ä¸Šä¸€å€‹ myInterceptor è®Šæ•¸ï¼Œä¸¦åŠ ä¸Š @Autowired è¨»è§£ï¼Œæ³¨å…¥å‰›å‰›å‰µå»ºçš„æ””æˆªå™¨ã€‚
    4. åœ¨ addInterceptors() æ–¹æ³•ä¸­å¯«ä¸Š **<mark><font color="red">registry.addInterceptor(myInterceptor).addPathPatterns (â€/*â€)</font></mark>**ï¼Œå°‡å‰›å‰›å‰µå»ºçš„æ””æˆªå™¨å¥—ç”¨åˆ°æ‰€æœ‰çš„ url è·¯å¾‘ä¸Šã€‚
    ![](/assets/img/2025-08-07-03-10-44.png)  
    <br>    

> ğŸ’¡ **é‡é»ï¼š**
> æ””æˆªå™¨å¯«æ³•ä¸­æœ€é‡è¦çš„æ˜¯ï¼ŒpreHandle() æ–¹æ³•è¿”å›çš„å€¼ï¼Œå¦‚ä½•è¨­è¨ˆé€™å€‹è¿”å›å€¼å¾ˆé‡è¦ã€‚
> - è¿”å› trueï¼šå…è¨± http request é€šéã€‚
> - è¿”å› flaseï¼šæ‹’çµ• http requestã€‚

### é‹è¡Œçµæœ

1. è‹¥è¿”å› trueï¼šé‹è¡ŒæˆåŠŸï¼Œä¸¦åœ¨ response body ä¸­è¿”å› Hello test1ï¼Œä¸”åœ¨ console ä¸­å…ˆå°å‡ºäº† "åŸ·è¡Œ MyInterceptor çš„ preHandle æ–¹æ³•â€ï¼ˆå› ç‚ºåŸ·è¡Œæ–¹æ³•å‰æœƒå…ˆåŸ·è¡Œ preHandle æ–¹æ³•ï¼‰ã€‚
    ![](/assets/img/2025-08-07-03-10-55.png)
    ![](/assets/img/2025-08-07-03-11-03.png)
    
2. è‹¥è¿”å› falseï¼šä¾ç„¶é‹è¡ŒæˆåŠŸï¼Œä½† response body æ²’æœ‰ä»»ä½•å…§å®¹ï¼Œè€Œ console ä¸­ä¹Ÿåªæœ‰å°å‡º  "åŸ·è¡Œ MyInterceptor çš„ preHandle æ–¹æ³•â€ï¼Œä»£è¡¨æŒ‡åŸ·è¡Œ preHandle æ–¹æ³•è€Œæ²’æœ‰åŸ·è¡Œ test1() æ–¹æ³•ã€‚  
    â‡’ å› ç‚ºæ””æˆªå™¨ return falseï¼Œæ‹’çµ•è®“ http request é€šéã€‚
    ![](/assets/img/2025-08-07-03-11-12.png)
    ![](/assets/img/2025-08-07-03-11-20.png)
    

<**è£œå……**>  
æˆ‘å€‘ä¹Ÿå¯ä»¥è‡ªè¡Œè¨­å®šè¦è¿”å›çš„ http ç‹€æ…‹ç¢¼ï¼Œä¾‹å¦‚ï¼šæˆ‘å€‘è¿”å› http status = 401ï¼Œä»£è¡¨ â€œç„¡æ³•é€šéèº«åˆ†é©—è­‰â€ ï¼ˆå¯é€éæ­¤æ–¹æ³•å¯«å‡ºã€Œèº«åˆ†é©—è­‰ã€çš„ç¨‹å¼ ï¼‰ã€‚
![](/assets/img/2025-08-07-03-11-29.png)
![](/assets/img/2025-08-07-03-11-36.png)